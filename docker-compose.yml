services:
  codegen:
    build:
      context: ./codegen
      dockerfile: Dockerfile
    container_name: codegen_frontend  # ğŸ”¹ Nom explicite pour le conteneur
    image: codegen_frontend_image  # ğŸ”¹ Nom de l'image en minuscule
    ports:
      - "3000:3000"  # ğŸ”¹ Expose le frontend sur localhost:3000
    volumes:
      - ./codegen:/app  # ğŸ”¹ Monte le dossier pour dÃ©veloppement en direct
    command: ["npm", "run", "watch"]
    depends_on:
      - codegen_api  # ğŸ”¹ Assure que le backend dÃ©marre avant le frontend
    restart: always  # ğŸ”¹ RedÃ©marre en cas de crash

  codegen_api:
    build:
      context: ./codegenApi
      dockerfile: Dockerfile
    container_name: codegen_backend  # ğŸ”¹ Nom explicite pour le conteneur
    image: codegen_backend_image  # ğŸ”¹ Nom de l'image en minuscule
    ports:
      - "8000:8000"  # ğŸ”¹ Expose FastAPI sur localhost:8000
    volumes:
      - ./codegenApi:/app
    env_file:
      - ./codegenApi/.env  # ğŸ”¹ Chargement des variables d'environnement
    command: ["uvicorn", "api:app", "--host", "0.0.0.0", "--port", "8000", "--reload"]
    restart: always  # ğŸ”¹ RedÃ©marre en cas de crash
